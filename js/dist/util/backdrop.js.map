{"version":3,"file":"backdrop.js","sources":["../../src/util/backdrop.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Bootstrap util/backdrop.js\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport EventHandler from '../dom/event-handler.js'\nimport Config from './config.js'\nimport {\n  execute, executeAfterTransition, getElement, reflow\n} from './index.js'\n\n/**\n * Constants\n */\n\nconst NAME = 'backdrop'\nconst CLASS_NAME_FADE = 'fade'\nconst CLASS_NAME_SHOW = 'show'\nconst EVENT_MOUSEDOWN = `mousedown.bs.${NAME}`\n\nconst Default = {\n  className: 'modal-backdrop',\n  clickCallback: null,\n  isAnimated: false,\n  isVisible: true, // if false, we use the backdrop helper without adding any element to the dom\n  rootElement: 'body' // give the choice to place backdrop under different elements\n}\n\nconst DefaultType = {\n  className: 'string',\n  clickCallback: '(function|null)',\n  isAnimated: 'boolean',\n  isVisible: 'boolean',\n  rootElement: '(element|string)'\n}\n\n/**\n * Class definition\n */\n\nclass Backdrop extends Config {\n  constructor(config) {\n    super()\n    this._config = this._getConfig(config)\n    this._isAppended = false\n    this._element = null\n  }\n\n  // Getters\n  static get Default() {\n    return Default\n  }\n\n  static get DefaultType() {\n    return DefaultType\n  }\n\n  static get NAME() {\n    return NAME\n  }\n\n  // Public\n  show(callback) {\n    if (!this._config.isVisible) {\n      execute(callback)\n      return\n    }\n\n    this._append()\n\n    const element = this._getElement()\n    if (this._config.isAnimated) {\n      reflow(element)\n    }\n\n    element.classList.add(CLASS_NAME_SHOW)\n\n    this._emulateAnimation(() => {\n      execute(callback)\n    })\n  }\n\n  hide(callback) {\n    if (!this._config.isVisible) {\n      execute(callback)\n      return\n    }\n\n    this._getElement().classList.remove(CLASS_NAME_SHOW)\n\n    this._emulateAnimation(() => {\n      this.dispose()\n      execute(callback)\n    })\n  }\n\n  dispose() {\n    if (!this._isAppended) {\n      return\n    }\n\n    EventHandler.off(this._element, EVENT_MOUSEDOWN)\n\n    this._element.remove()\n    this._isAppended = false\n  }\n\n  // Private\n  _getElement() {\n    if (!this._element) {\n      const backdrop = document.createElement('div')\n      backdrop.className = this._config.className\n      if (this._config.isAnimated) {\n        backdrop.classList.add(CLASS_NAME_FADE)\n      }\n\n      this._element = backdrop\n    }\n\n    return this._element\n  }\n\n  _configAfterMerge(config) {\n    // use getElement() with the default \"body\" to get a fresh Element on each instantiation\n    config.rootElement = getElement(config.rootElement)\n    return config\n  }\n\n  _append() {\n    if (this._isAppended) {\n      return\n    }\n\n    const element = this._getElement()\n    this._config.rootElement.append(element)\n\n    EventHandler.on(element, EVENT_MOUSEDOWN, () => {\n      execute(this._config.clickCallback)\n    })\n\n    this._isAppended = true\n  }\n\n  _emulateAnimation(callback) {\n    executeAfterTransition(callback, this._getElement(), this._config.isAnimated)\n  }\n}\n\nexport default Backdrop\n"],"names":["NAME","CLASS_NAME_FADE","CLASS_NAME_SHOW","EVENT_MOUSEDOWN","Default","className","clickCallback","isAnimated","isVisible","rootElement","DefaultType","Backdrop","_Config","config","_this","call","_config","_getConfig","_isAppended","_element","_inheritsLoose","_proto","prototype","show","callback","execute","_append","element","_getElement","reflow","classList","add","_emulateAnimation","hide","_this2","remove","dispose","EventHandler","off","backdrop","document","createElement","_configAfterMerge","getElement","_this3","append","on","executeAfterTransition","_createClass","key","get","Config"],"mappings":"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"}